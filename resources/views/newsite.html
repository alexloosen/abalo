<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Abalo</title>

    <!--<script src="./js/require.js"></script>-->
    <script src="/js/app.js"></script>
    <!--<script src="/index.js" type="module"></script>-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="/style.css">
    <link href="/fontawesome-free-5.11.2-web/css/all.css" rel="stylesheet">
    <script type="text/x-template" id="for-articles">
        <div>
            <input type="text" v-on:keyup="handleIt">
            <table style="width:100%">
                <tr>
                    <th>Title</th>
                    <th style="width:10%">Creator</th>
                    <th>Created at</th>
                    <th style="width:5%">Price</th>
                    <th>Description</th>
                </tr>
                <tr v-for="item in objects">
                    <td>{{item.ab_name}}</td>
                    <td>{{item.ab_creator_id}}</td>
                    <td>{{item.ab_createdate}}</td>
                    <td style="text-align: center">{{item.ab_price}}</td>
                    <td>{{item.ab_description}}</td>

                    <td><button type="button" class="btn btn-danger" v-on:click="deleteArticle(item.id)">Delete Article</button></td>
                    <td><button type="button" class="btn btn-primary" v-on:click="addToCart(item.id)">Add to Cart</button></td>
                </tr>
            </table></div>
    </script>
</head>
<div id="app">
    <sitebody>
    </sitebody>
</div>
<script>
    Vue.component('start-text', {
        template: '<p>Hier ist content!</p>'
    });


    Vue.component('articles', {
        template: '#for-articles',
        data: function() {
            return {
                objects: [],
                have_all_articles: false
            }
        },
        created: function(){
            var event = new Event('build');
            this.handleIt(event);
        },
        methods: {
            handleIt: function (event) {
                let searchTerm = "";
                if(event.target != null)
                    searchTerm = event.target.value;
                const XHR = new XMLHttpRequest();
                if (searchTerm.length > 3 ) {
                    // objects leeren, damit nicht die Ergebnisse mehrerer Suchanfragen aufgelistet werden
                    this.have_all_articles = false;
                    this.$data.objects = [];
                    // Set up our request
                    XHR.open("GET", '/api/articles/' + searchTerm);
                    let str_2 = 'Trying to send [\'search_term\' => ' + searchTerm + ']';
                    console.log(str_2);
                    XHR.onload =  () => {
                        let result = XHR.response;
                        let objs = JSON.parse(result).data;
                        for (let i = 0; i < objs.length; i++) {
                            this.objects.push({
                                id: objs[i].id,
                                ab_name: objs[i].ab_name,
                                ab_price: objs[i].ab_price,
                                ab_description: objs[i].ab_description,
                                ab_creator_id: objs[i].ab_creator_id,
                                ab_createdate: objs[i].ab_createdate,
                            });
                        }
                    }
                    XHR.send();
                    // Define what happens on successful data submission

                    console.log(this.objects);
                } else {
                    if(!this.have_all_articles){
                        this.$data.objects = [];
                        XHR.open( "GET", '/api/articles' );
                        let str = 'Trying to get all articles!';
                        console.log(str);
                        XHR.onload = () => {
                            if(XHR.status === 200){
                                // Do something with data
                                let result = XHR.response;
                                let objs = JSON.parse(result).data;
                                for (let i = 0; i < objs.length; i++) {
                                    this.objects.push({
                                        id: objs[i].id,
                                        ab_name: objs[i].ab_name,
                                        ab_price: objs[i].ab_price,
                                        ab_description: objs[i].ab_description,
                                        ab_creator_id: objs[i].ab_creator_id,
                                        ab_createdate: objs[i].ab_createdate,
                                    });
                                }
                            }else{
                                // Show error message
                            }
                        }
                        XHR.send();
                        this.have_all_articles = true;

                        console.log(this.objects);
                    }
                }
            },
            deleteArticle: function (id){
                const XHR = new XMLHttpRequest();
                // Set up our request
                XHR.open( "DELETE", '/api/articles/' + id );
                let str = 'Trying to send (delete) [\'id\' => ' + id + ']';
                console.log(str);
                XHR.send();
                // Define what happens on successful data submission
                XHR.addEventListener( "load", function(event) {
                    console.log('I\'ll show you the response text.');
                    console.log(event.target.responseText);
                    alert(event.target.responseText);
                } );
            },
            addToCart: function (id) {
                alert('I (' + id + ') would be added to the cart, if there was one.');
            }
        }
    });







    Vue.component('article-creation', {
        methods: {
            sendMe: function(emitted){
                //validation time
                if(this.$refs.ab_name.value == ""){
                    alert("Bitte geben Sie Ihrem Artikel einen Titel!");
                    return;
                }
                if(this.$refs.ab_price.value <= 0 || isNaN(parseInt(this.$refs.ab_price.value,10))){
                    alert("Bitte weisen Sie Ihrem Artikel einen gültigen Preis (größer 0) zu!");
                    return;
                }
                //validation successful
                //make XHRequest
                const XHR = new XMLHttpRequest();
                XHR.open( "POST", '/api/articles' );
                const fd = new FormData(emitted.target);
                XHR.send(fd);
                XHR.addEventListener( "load", function(event) {
                    console.log('I\'ll show you the response text.');
                    console.log(event.target.responseText);
                    alert( event.target.responseText );
                } );
            }
        },
        template:
            '<form v-on:submit.prevent="sendMe" id="the_form">' +
            '<div class="form-group">' +
            '<label for="name">Titel Ihres Artikels:</label>' +
            '<input type="text" ref="ab_name" name="ab_name"></div>' +
            '<div class="form-group">' +
            '<label for="price">Preis in €:</label>' +
            '<input type="text" ref="ab_price" name="ab_price"></div>' +
            '<div class="form-group">' +
            '<label for="description">Beschreibung:</label>' +
            '<textarea ref="ab_description" name="ab_description"></textarea></div>' +
            '<input type="hidden" value="1" ref="ab_creator_id" name="ab_creator_id">' +
            '<button type="submit" class="btn btn-secondary" style="margin-left: 200px;">Anzeige aufgeben</button>' +
            '</form>'
    });

    Vue.component('menu-component', {
        template: '<div style="border: 2px solid darkgrey; padding: .25rem; margin: .5rem; margin-right: 0px;" class="col-md-auto">' +
            '<ul><li><a v-on:click="goHome">Home</a></li>' +
            '<li><a v-on:click="goKategorien">Kategorien</a></li>' +
            '<li><a v-on:click="goVerkaufen">Verkaufen</a></li>' +
            '<li><a href="#">Unternehmen</a>' +
            '<ul><a href="#">Philosophie</a></ul>' +
            '<ul><a v-on:click="goComp">Karriere</a></ul></li></ul>' +
            '</div>',
        methods: {
            goHome: function(){
                this.$emit('childevent', 'start-text')
            },
            goKategorien: function(){
                this.$emit('childevent', 'articles')
            },
            goVerkaufen: function () {
                this.$emit('childevent', 'article-creation')
            },
            goComp: function (){
                this.$emit('childevent','example-component')
            }
        }
    });

    Vue.component('impressum', {
        template: '<div><h1 class="adsimple-321179911">Impressum</h1>\n' +
            '<p class="adsimple-321179911">Informationspflicht laut § 5 TMG.</p>\n' +
            '<p class="adsimple-321179911">MusterFirma<br />Musterstrasse 1, Stiege 1 Tür 1, <br />12345 Musterhausen, <br />Deutschland</p>\n' +
            '<p class="adsimple-321179911">\n' +
            '<strong>UID-Nummer:</strong> DE12345678<br />\n' +
            '<strong>Wirtschafts-ID:</strong> DE123456789<br />\n' +
            '</p>\n' +
            '<p class="adsimple-321179911">\n' +
            '<strong>Tel.:</strong> 01234/56789<br />\n' +
            '<strong>Fax:</strong> 01234/56789-0<br />\n' +
            '<strong>E-Mail:</strong> <a href="mailto:office@musterfirma.de">office@musterfirma.de</a>\n' +
            '</p>\n' +
            '<p class="adsimple-321179911">\n' +
            '<strong>Aufsichtsbehörde</strong>\n' +
            '<br>Bezirkshauptmannschaft Musterhausen<br />\n' +
            '<strong>Webseite der Aufsichtsbehörde</strong>\n' +
            '<br>\n' +
            '<a href="https://www.aufsichtsbeoerde-musterhausen.de/" target="_blank">https://www.aufsichtsbeoerde-musterhausen.de/</a>\n' +
            '<br />\n' +
            '<strong>Anschrift der Aufsichtsbehörde</strong>\n' +
            '<br> Musterweg 1, 12345 Musterhausen<br />\n' +
            '</p>\n' +
            '<p class="adsimple-321179911">\n' +
            '<strong>Berufsbezeichnung:</strong> Webdesigner, Grafiker</p>\n' +
            '<p style="margin-top:15px;">Quelle: Erstellt mit dem <a title="Impressum Generator Deutschland" href="https://www.adsimple.de/impressum-generator/" target="_blank" rel="follow" style="text-decoration:none;">Impressum Generator</a> von AdSimple in Kooperation mit <a href="https://www.justmed.de" target="_blank" rel="follow" title="">justmed.de</a>\n' +
            '</p>\n' +
            '<h2 class="adsimple-321179911">EU-Streitschlichtung</h2>\n' +
            '<p>Gemäß Verordnung über Online-Streitbeilegung in Verbraucherangelegenheiten (ODR-Verordnung) möchten wir Sie über die Online-Streitbeilegungsplattform (OS-Plattform) informieren.<br />\n' +
            'Verbraucher haben die Möglichkeit, Beschwerden an die Online Streitbeilegungsplattform der Europäischen Kommission unter <a class="adsimple-321179911" href="https://ec.europa.eu/consumers/odr/main/index.cfm?event=main.home2.show&amp;lng=DE" target="_blank" rel="noopener">http://ec.europa.eu/odr?tid=321179911</a> zu richten. Die dafür notwendigen Kontaktdaten finden Sie oberhalb in unserem Impressum.</p>\n' +
            '<p>Wir möchten Sie jedoch darauf hinweisen, dass wir nicht bereit oder verpflichtet sind, an Streitbeilegungsverfahren vor einer Verbraucherschlichtungsstelle teilzunehmen.</p>\n' +
            '<h2 class="adsimple-321179911">Haftung für Inhalte dieser Website</h2>\n' +
            '<p>Wir entwickeln die Inhalte dieser Webseite ständig weiter und bemühen uns korrekte und aktuelle Informationen bereitzustellen. Laut Telemediengesetz <a class="adsimple-321179911" href="https://www.gesetze-im-internet.de/tmg/__7.html?tid=321179911" rel="noopener" target="_blank">(TMG) §7 (1)</a> sind wir als Diensteanbieter für eigene Informationen, die wir zur Nutzung bereitstellen, nach den allgemeinen Gesetzen verantwortlich. Leider können wir keine Haftung für die Korrektheit aller Inhalte auf dieser Webseite übernehmen, speziell für jene die seitens Dritter bereitgestellt wurden. Als Diensteanbieter im Sinne der §§ 8 bis 10 sind wir nicht verpflichtet, die von ihnen übermittelten oder gespeicherten Informationen zu überwachen oder nach Umständen zu forschen, die auf eine rechtswidrige Tätigkeit hinweisen.</p>\n' +
            '<p>Unsere Verpflichtungen zur Entfernung von Informationen oder zur Sperrung der Nutzung von Informationen nach den allgemeinen Gesetzen aufgrund von gerichtlichen oder behördlichen Anordnungen bleiben auch im Falle unserer Nichtverantwortlichkeit nach den §§ 8 bis 10 unberührt. </p>\n' +
            '<p>Sollten Ihnen problematische oder rechtswidrige Inhalte auffallen, bitte wir Sie uns umgehend zu kontaktieren, damit wir die rechtswidrigen Inhalte entfernen können. Sie finden die Kontaktdaten im Impressum.</p>\n' +
            '<h2 class="adsimple-321179911">Haftung für Links auf dieser Website</h2>\n' +
            '<p>Unsere Webseite enthält Links zu anderen Webseiten für deren Inhalt wir nicht verantwortlich sind. Haftung für verlinkte Websites besteht für uns nicht, da wir keine Kenntnis rechtswidriger Tätigkeiten hatten und haben, uns solche Rechtswidrigkeiten auch bisher nicht aufgefallen sind und wir Links sofort entfernen würden, wenn uns Rechtswidrigkeiten bekannt werden.</p>\n' +
            '<p>Wenn Ihnen rechtswidrige Links auf unserer Website auffallen, bitte wir Sie uns zu kontaktieren. Sie finden die Kontaktdaten im Impressum.</p>\n' +
            '<h2 class="adsimple-321179911">Urheberrechtshinweis</h2>\n' +
            '<p>Alle Inhalte dieser Webseite (Bilder, Fotos, Texte, Videos) unterliegen dem Urheberrecht der Bundesrepublik Deutschland. Bitte fragen Sie uns bevor Sie die Inhalte dieser Website verbreiten, vervielfältigen oder verwerten wie zum Beispiel auf anderen Websites erneut veröffentlichen. Falls notwendig, werden wir die unerlaubte Nutzung von Teilen der Inhalte unserer Seite rechtlich verfolgen.</p>\n' +
            '<p>Sollten Sie auf dieser Webseite Inhalte finden, die das Urheberrecht verletzen, bitten wir Sie uns zu kontaktieren.</p>\n' +
            '<h2 class="adsimple-321179911">Bildernachweis</h2>\n' +
            '<p>Die Bilder, Fotos und Grafiken auf dieser Webseite sind urheberrechtlich geschützt.</p>\n' +
            '<p>Die Bilderrechte liegen bei den folgenden Fotografen und Unternehmen:</p>\n' +
            '<ul class="adsimple-321179911">\n' +
            '<li class="adsimple-321179911">Fotograf Mustermann</li>\n' +
            '</ul>\n' +
            '<h1 class="adsimple-321179911">Datenschutzerklärung</h1>\n' +
            '<h2 class="adsimple-321179911">Datenschutz</h2>\n' +
            '<p>Wir haben diese Datenschutzerklärung (Fassung 24.05.2020-321179911) verfasst, um Ihnen gemäß der Vorgaben der <a class="adsimple-321179911" href="https://eur-lex.europa.eu/legal-content/DE/ALL/?uri=celex%3A32016R0679&amp;tid=321179911" target="_blank" rel="noopener">Datenschutz-Grundverordnung (EU) 2016/679</a> zu erklären, welche Informationen wir sammeln, wie wir Daten verwenden und welche Entscheidungsmöglichkeiten Sie als Besucher dieser Webseite haben.</p>\n' +
            '<p>Leider liegt es in der Natur der Sache, dass diese Erklärungen sehr technisch klingen, wir haben uns bei der Erstellung jedoch bemüht die wichtigsten Dinge so einfach und klar wie möglich zu beschreiben.</p>\n' +
            '<p style="margin-top:15px;">Quelle: Erstellt mit dem <a title="Datenschutz Generator Deutschland" href="https://www.adsimple.de/datenschutz-generator/" target="_blank" rel="follow" style="text-decoration:none;">Datenschutz Generator</a> von AdSimple in Kooperation mit <a href="https://www.hashtagmann.de" target="_blank" rel="follow" title="">hashtagmann.de</a>\n' +
            '</p></div>'
    });
    Vue.component('siteheader',{
        template: '<header>\n' +
            '        <div class="row mt-3 mb-1">\n' +
            '            <div class="col p-1 m-2">\n' +
            '                <div class="row align-items-center">\n' +
            '                    <div class="col-md-auto ml-2"><button v-on:click="menuHandling"><i class="fas fa-bars" style="align-self: center; font-size:3rem; color:dimgray;"></i></button></div>\n' +
            '                    <div class="col">\n' +
            '                        <h1>Abalo</h1>\n' +
            '                        <p>Das ist unser Slogan.</p>\n' +
            '                    </div>\n' +
            '                </div>\n' +
            '            </div>\n' +
            '        </div>\n' +
            '    </header>',
        methods: {
            menuHandling: function () {
                this.$emit('menuevent', 'menu-component');
            }
        }
    });
    Vue.component('sitefooter', {
        template: '<footer>\n' +
            '        <div class="row mt-1 mb-3">\n' +
            '            <div class="col p-1 m-2">\n' +
            '                <p>Copyright<a v-on:click="goToImpressum" style="margin-left: 3rem">Impressum</a></p>' +
            '            </div>\n' +
            '        </div>\n' +
            '    </footer>',
        methods: {
            goToImpressum: function () {
                this.$emit('childevent', 'impressum');
            }
        }
    });
    Vue.component('sitebody',{
        data: function() {
            return {
                curComponent: 'start-text',
                menuComponent: 'div',
            }
        },
        template:'<body>\n' +
            '<div class="container" style="margin:0px; max-width: 100%;">' +
            '<siteheader v-on:menuevent="showMenu"></siteheader>' +
            '<div class="row mt-1 mb-1">\n' +
            '        <component v-bind:is="menuComponent" v-on:childevent="showMe"></component>\n' +
            '        <div class="col p-1 m-2">\n' +
            // hier kommt der content hin
            '<component v-bind:is="curComponent" id="1"></component>' +
            //
            '        </div>\n' +
            '    </div>' +
            '<sitefooter v-on:childevent="showMe"></sitefooter>' +
            '</div>\n' +
            '</body>\n',
        methods: {
            showMe: function (emitted) {
                this.curComponent = emitted;
            },
            showMenu: function(emitted){
                if(this.menuComponent != emitted)
                    this.menuComponent = emitted;
                else
                    this.menuComponent = 'div';
            }
        }
    });

    new Vue ({
        el: '#app'
    });
</script>

</html>
